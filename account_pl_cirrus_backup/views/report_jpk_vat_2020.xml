<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <template id="custom_jpk_vat_2020_layout">
      <t t-if="o and 'company_id' in o">
        <t t-set="company" t-value="o.company_id"></t>
      </t>
      <t t-if="not o or not 'company_id' in o">
        <t t-set="company" t-value="res_company"></t>
      </t>

      <t t-call="account_pl_cirrus.jpk_vat_2020_layout_header"/>
      <div class="article">
        <t t-raw="0"/>
      </div>

    </template>
    <template id="jpk_vat_2020_layout_header">
      <div class="header">
        <p class="oe_openglobe">Wydruk z Odoo – Systemu ERP o darmowej licencji. Zaprojektowano przez www.openglobe.pl</p>
        <div class="row">
          <div class="col-10">
            <t t-if="data['correction_number'] == 1">
              <p class="oe_inv_reg_desc">
                Raport JPK VDEK: od
                <span t-esc="data['date_from']"/>
                do
                <span t-esc="data['date_to']"/>
              </p>
            </t>
            <t t-else="">
              <p class="oe_inv_reg_desc">
                Korekta <span t-esc="data['correction_number']"/> JPK VDEK: od
                <span t-esc="data['date_from']"/>
                do
                <span t-esc="data['date_to']"/>
              </p>
            </t>
          </div>
          <div class="col-2">
            <p class="pull-right">Strona
              <span class="page"/>
              z
              <span class="topage"/></p>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <h4>Firma:
              <span t-field="company.name"/>,
              <span t-field="company.street"/>,
              <span t-field="company.zip"/>
              <span t-field="company.city"/></h4>
          </div>
        </div>
      </div>
    </template>
    <template id="report_jpk_vat_2020_pdf">
        <t t-call="web.html_container">
          <t t-call="account_pl_cirrus.custom_jpk_vat_2020_layout">
            <div class="page" style='font-size : 12px;'>
              <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"/>
              <t t-if="(data['correction_number'] != 1 and data['correction_record']) or data['correction_number'] == 1">
              <p class="pull-left" style='margin-top: 35px;'>Sprzedaż:</p>
                <table class="table table-sm"  style='font-size : 9px;'>
                  <thead>
                    <tr>
                      <th>
                        <p>LP<br/></p>
                      </th>
                      <th style="white-space: nowrap;">
                        <p>Nazwa Kontrahenta</p>
                      </th>
                      <th>
                        <p>NIP</p>
                      </th>
                      <th style="min-width:20%; max-width: 25%">
                        <p>Adres Kontrahenta</p>
                      </th>
                      <th>
                        <p>Dowód Sprzedaży</p>
                      </th>
                      <th>
                        <p>Data Wystawienia</p>
                      </th>
                      <th>
                        <p>Data Sprzedaży</p>
                      </th>
                      <th>
                        <p>Znaczniki Towarów</p>
                      </th>
                      <th>
                        <p>Znaczniki Procedur</p>
                      </th>
                      <th>
                        <p>Podatki</p>
                      </th>
                      <th>
                      </th>
                      <th>
                      </th>
                    </tr>
                  </thead>
                  <tbody>

                    <t t-set="sale_dict" t-value="data['vat_dict']['sale_dict']"/>
                    <t t-foreach="sorted(sale_dict, key=lambda x: strptime(sale_dict[x]['original_move_date'], '%Y-%m-%d'))" t-as="lp">
                      <tr style="page-break-inside: avoid !important;">
                        <td><span t-esc="lp_index+1"/></td>
                        <td class="text-center"><span t-esc="sale_dict[lp]['partner_data']['name']"/></td>
                        <td class="text-center"><span t-esc="sale_dict[lp]['partner_data']['vat']"/></td>
                        <td><span t-esc="sale_dict[lp]['partner_data']['address']"/></td>
                        <td><span t-esc="sale_dict[lp]['main_reference']"/></td>
                        <td align='right'><span t-esc="sale_dict[lp]['date_issue']"/></td>
                        <td align='right'><span t-esc="sale_dict[lp]['display_date']"/></td>
                        <td>
                          <t t-foreach="sorted(sale_dict[lp]['product_tax_markers'])" t-as='marker'>
                            <span t-esc="marker"/>
                          </t>
                        </td>
                        <td>
                          <t t-foreach="sorted(sale_dict[lp]['procedures_markers'])" t-as='procedure'>
                            <span t-esc="procedure"/>
                          </t>
                        </td>
                        <td>
                          <t t-foreach="sorted(sale_dict[lp]['tax_values'])" t-as='tax'>
                            <span t-esc="tax"/>:&#160;<span t-esc="sale_dict[lp]['tax_values'][tax]"/>
                          </t>
                        </td>
                      </tr>
                    </t>
                  </tbody>

                <table class="table table-condensed"  style='font-size : 9px;width: 40%;'>
                  <t t-set="tax_control" t-value="data['vat_dict']['sale_ctrl']['taxes_check_sum']"/>
                  <thead>
                    <t t-foreach="sorted(tax_control)" t-as='tax_name'>
                      <th><span t-esc="tax_name"/></th>
                    </t>
                  </thead>
                  <tbody>
                    <t t-foreach="tax_control" t-as='tax_name'>
                      <td><span t-esc="'%.2f'% tax_control[tax_name]"/></td>
                    </t>
                  </tbody>
                </table>

                </table>
                <div style='margin : 30px;'>
                  <t t-set="sale_ctrl" t-value="data['vat_dict']['sale_ctrl']"/>
                  <b>Liczba Sprzedaży:
                  </b><span t-esc="sale_ctrl['lp']"/>
                  <br/>
                  <b>Suma Netto:
                  </b><span t-esc="sale_ctrl['sum_base']"/>
                  <br/>
                  <b>Suma VAT:
                  </b><span t-esc="sale_ctrl['sum_taxes']"/>
                </div>


                <p class="pull-left" style='margin-top: 35px;'>Zakupy:</p>
                <table class="table table-sm" style='font-size : 10px'>
                  <thead>
                    <tr>
                      <th>
                        <p>LP<br/></p>
                      </th>
                      <th style="white-space: nowrap;">
                        <p>Nazwa Dostawcy</p>
                      </th>
                      <th>
                        <p>NIP</p>
                      </th>
                      <th style="min-width:20%; max-width: 25%">
                        <p>Adres Dostawcy</p>
                      </th>
                      <th>
                        <p>Dowód Zakupu</p>
                      </th>
                      <th>
                        <p>Data Zakupu</p>
                      </th>
                      <th>
                        <p>Data Wpływu</p>
                      </th>
                      <th>
                        <p>Znaczniki Procedur</p>
                      </th>
                      <th>
                        <p>Kwota Netto</p>
                      </th>
                      <th>
                        <p>Podatek</p>
                      </th>
                    </tr>
                  </thead>

                  <tbody>
                    <t t-set="purchase_dict" t-value="data['vat_dict']['purchase_dict']"/>
                    <t t-foreach="sorted(purchase_dict, key=lambda x: strptime(purchase_dict[x]['original_move_date'], '%Y-%m-%d'))" t-as="lp">
                      <tr style="page-break-inside: avoid !important;">
                        <td><span t-esc="lp_index+1"/></td>
                        <td class="text-center"><span t-esc="purchase_dict[lp]['partner_name']"/></td>
                        <td class="text-center"><span t-esc="purchase_dict[lp]['vat']"/></td>
                        <td><span t-esc="purchase_dict[lp]['address']"/></td>
                        <td><span t-esc="purchase_dict[lp]['main_reference']"/></td>
                        <td align='right'><span t-esc="purchase_dict[lp]['purchase_date']"/></td>
                        <td><span t-esc="purchase_dict[lp]['date_recived']"/></td>
                        <td>
                          <t t-foreach="sorted(purchase_dict[lp]['procedures_markers'])" t-as='procedure'>
                            <span t-esc="procedure"/>
                          </t>
                        </td>
                        <t t-foreach="sorted(purchase_dict[lp]['tax_values'])" t-as='tax'>
                          <td><span t-esc="purchase_dict[lp]['tax_values'][tax]"/></td>
                        </t>
                      </tr>
                    </t>
                  </tbody>

                </table>

                <div style='margin : 30px;'>
                  <t t-set="purchase_ctrl" t-value="data['vat_dict']['purchase_ctrl']"/>
                  <b>Liczba Zakupów:
                  </b><span t-esc="purchase_ctrl['lp']"/>
                  <br/>
                  <b>Suma Netto:
                  </b><span t-esc="purchase_ctrl['sum_base']"/>
                  <br/>
                  <b>Suma VAT:
                  </b><span t-esc="purchase_ctrl['sum_taxes']"/>
                </div>
              </t>

              <t t-if="(data['correction_number'] != 1 and data['correction_declaration']) or data['correction_number'] == 1">
                <t t-if="data['no_declaration_data'] != true">
                  <div style='width:20%;'>
                  <p class="pull-left" style='margin-top: 35px;'>Pozycje Szczegółowe:</p>
                  <table class="table table-sm" style='font-size : 10px;'>
                    <thead>
                      <tr>
                        <th>
                          <p>Kod</p>
                        </th>
                        <th>
                          <p>Wartość</p>
                        </th>
                      </tr>
                    </thead>
                    <body>
                      <t t-set="taxes_sum_dict" t-value="data['vat_dict']['taxes_sum_dict']"/>
                      <t t-foreach="sorted(taxes_sum_dict)" t-as='tax'>
                        <tr style="page-break-inside: avoid !important;">
                          <td><span t-esc="tax"/></td>
                          <td><span t-esc="taxes_sum_dict[tax]"/></td>
                        </tr>
                      </t>
                    </body>
                  </table>
                </div>
              </t>
            </t>


            </div>
          </t>
        </t>
      </template>
  </data>
</odoo>
